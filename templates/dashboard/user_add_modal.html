{% load static %}

<form method="post" action="{% url 'add_user' %}" enctype="multipart/form-data" class="space-y-6" id="add-user-form">
    {% csrf_token %}
    
    <!-- Basic Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Username <span class="text-red-500">*</span></label>
            {{ form.username }}
            {% if form.username.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.username.errors.0 }}</p>
            {% endif %}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Email <span class="text-red-500">*</span></label>
            {{ form.email }}
            {% if form.email.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
            {% endif %}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">First Name</label>
            {{ form.first_name }}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Last Name</label>
            {{ form.last_name }}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Password <span class="text-red-500">*</span></label>
            {{ form.password1 }}
            {% if form.password1.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.password1.errors.0 }}</p>
            {% endif %}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm Password <span class="text-red-500">*</span></label>
            {{ form.password2 }}
            {% if form.password2.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.password2.errors.0 }}</p>
            {% endif %}
        </div>

        {% if form.role %}
        <div class="md:col-span-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Role <span class="text-red-500">*</span></label>
            {{ form.role }}
            {% if form.role.errors %}
            <p class="mt-1 text-sm text-red-600">{{ form.role.errors.0 }}</p>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Bio -->
    <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Bio</label>
        {{ form.bio }}
    </div>

    <!-- Profile Image -->
    <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Profile Image</label>
        <div class="flex items-center gap-4">
            <div id="modal-preview-image" class="w-16 h-16 rounded-full bg-primary/10 text-primary flex items-center justify-center">
                <i class="fas fa-user"></i>
            </div>
            <div class="flex-1">
                {{ form.profile_image }}
                <p class="mt-1 text-xs text-gray-500">JPG, JPEG, PNG up to 5MB</p>
            </div>
        </div>
    </div>

    <!-- Website -->
    <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">Website</label>
        {{ form.website }}
    </div>

    <!-- Social Links -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fab fa-facebook-f mr-1 text-blue-600"></i> Facebook
            </label>
            {{ form.facebook }}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fab fa-twitter mr-1 text-sky-500"></i> Twitter
            </label>
            {{ form.twitter }}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fab fa-linkedin-in mr-1 text-blue-700"></i> LinkedIn
            </label>
            {{ form.linkedin }}
        </div>

        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fab fa-instagram mr-1 text-pink-600"></i> Instagram
            </label>
            {{ form.instagram }}
        </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3 pt-4 border-t border-gray-200">
        <button type="submit" class="px-6 py-2 bg-primary text-white font-semibold rounded-lg hover:bg-primary/90 transition">
            <i class="fas fa-save mr-2"></i>Create User
        </button>
        <button type="button" onclick="closeModal()" class="px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition">
            Cancel
        </button>
    </div>
</form>

<script>
// Handle form submission
document.getElementById('add-user-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating...';
    
    fetch(this.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.reload();
        } else {
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Create User';
            alert('Error: ' + (data.message || 'Failed to create user'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Create User';
        alert('An error occurred. Please try again.');
    });
});
</script>