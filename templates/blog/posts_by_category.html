{% extends 'blog_base.html' %}
{% load static %}

{% block title %}{{ category.name }} - WTD Digital Agency{% endblock %}
{% block meta_description %}{{ category.description|default:"Browse articles in the "|add:category.name|add:" category." }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-white py-12">
  <div class="max-w-7xl mx-auto px-4 md:px-8">
    
    <!-- Breadcrumb -->
    <nav class="mb-6" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2 text-sm">
        <li>
          <a href="{% url 'blog' %}" class="text-gray-600 hover:text-primary transition">Blog</a>
        </li>
        <li>
          <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
        </li>
        <li>
          <span class="text-gray-900 font-semibold">{{ category.name }}</span>
        </li>
      </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Main Content -->
      <div class="lg:col-span-2">
        
        <!-- Category Header -->
        <div class="mb-8">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">{{ category.name }}</h1>
          {% if category.description %}
          <p class="text-lg text-gray-600 leading-relaxed">{{ category.description }}</p>
          {% endif %}
        </div>

        <!-- Articles Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
          {% for post in page_obj %}
          <article class="group border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow">
            <!-- Image -->
            <div class="relative h-48 overflow-hidden">
              {% if post.featured_image %}
              <img 
                src="{{ post.featured_image.url }}" 
                alt="{{ post.title }}" 
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
              />
              {% else %}
              <div class="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300"></div>
              {% endif %}
              
              <!-- Category Badge -->
              <div class="absolute top-3 left-3">
                {% for cat in post.category.all %}
                <a 
                  href="{% url 'posts_by_category_page_or_post' slug=cat.slug %}" 
                  class="inline-block text-xs font-bold uppercase tracking-wide bg-white text-gray-900 px-2 py-1 rounded shadow hover:bg-primary hover:text-white transition-colors"
                >
                  {{ cat.name }}
                </a>
                {% endfor %}
              </div>
            </div>
            
            <!-- Content -->
            <div class="p-5">
              <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight line-clamp-2">
                <a 
                  href="{% url 'posts_by_category_page_or_post' slug=post.slug %}" 
                  class="hover:text-primary transition-colors"
                >
                  {{ post.title }}
                </a>
              </h3>
              
              <p class="text-xs text-gray-700 mb-4 line-clamp-3">
                {{ post.excerpt | safe }}
              </p>
              
              <!-- Meta Info -->
              <div class="flex items-center justify-between text-xs text-gray-600 pt-4 border-t border-gray-200">
                <span class="font-semibold">{{ post.author_display_name }}</span>
                <div class="flex items-center gap-2">
                  <time datetime="{{ post.published_date }}">{{ post.published_date|date:"M j, Y" }}</time>
                  <span>•</span>
                  <span>{{ post.read_time }} min</span>
                </div>
              </div>
            </div>
          </article>
          {% empty %}
          <div class="col-span-full text-center py-12">
            <p class="text-gray-500 text-lg">No articles found in this category.</p>
            <a href="{% url 'blog' %}" class="inline-block mt-4 text-primary hover:text-primary/80 font-semibold">
              Browse all articles →
            </a>
          </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <div class="flex justify-center">
          <nav class="inline-flex items-center space-x-2" aria-label="Pagination">
            {% if page_obj.has_previous %}
            <a 
              href="?page={{ page_obj.previous_page_number }}" 
              class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
            >
              <span class="hidden sm:inline">Previous</span>
              <span class="sm:hidden">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
              </span>
            </a>
            {% endif %}
            
            <!-- Page Numbers - Hidden on mobile, shown on tablet+ -->
            <div class="hidden md:flex items-center space-x-2">
              {% for num in page_obj.paginator.page_range %}
                {% if num == page_obj.number %}
                <span class="px-4 py-2 bg-primary text-white rounded-lg font-medium">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a 
                  href="?page={{ num }}" 
                  class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
                >
                  {{ num }}
                </a>
                {% endif %}
              {% endfor %}
            </div>
            
            <!-- Mobile page indicator -->
            <div class="md:hidden px-4 py-2 border border-gray-300 rounded-lg text-gray-700">
              <span class="font-medium">{{ page_obj.number }}</span> / {{ page_obj.paginator.num_pages }}
            </div>
            
            {% if page_obj.has_next %}
            <a 
              href="?page={{ page_obj.next_page_number }}" 
              class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-primary hover:text-white hover:border-primary transition-colors"
            >
              <span class="hidden sm:inline">Next</span>
              <span class="sm:hidden">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </span>
            </a>
            {% endif %}
          </nav>
        </div>
        {% endif %}
      </div>

      <!-- Sidebar (Sticky) -->
      <aside class="lg:col-span-1">
        <div class="sticky top-24 space-y-6">
          
          <!-- Search Widget -->
          <div class="p-6 bg-gray-50 rounded-lg border border-gray-200">
            <h4 class="text-lg font-bold text-gray-900 mb-4">Search</h4>
            <form method="get" action="#">
              <div class="relative">
                <input 
                  type="search" 
                  name="q" 
                  placeholder="Search articles..." 
                  class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary text-sm"
                />
                <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                  </svg>
                </button>
              </div>
            </form>
          </div>

          <!-- All Categories -->
          <div class="p-6 bg-gray-50 rounded-lg border border-gray-200">
            <h4 class="text-lg font-bold text-gray-900 mb-4">Categories</h4>
            <ul class="space-y-2">
              {% for cat in categories %}
              <li>
                <a 
                  href="{% url 'posts_by_category_page_or_post' slug=cat.slug %}" 
                  class="flex items-center justify-between text-sm text-gray-700 hover:text-primary transition group"
                >
                  <span class="{% if cat.slug == category.slug %}font-bold text-primary{% endif %}">{{ cat.name }}</span>
                  <svg class="w-4 h-4 opacity-0 group-hover:opacity-100 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>

          <!-- Popular Posts -->
          {% if popular_posts %}
          <div class="p-6 bg-gray-50 rounded-lg border border-gray-200">
            <h4 class="text-lg font-bold text-gray-900 mb-4">Popular Posts</h4>
            <div class="space-y-4">
              {% for post in popular_posts %}
              <article class="group flex gap-3">
                <div class="w-20 h-20 flex-shrink-0 rounded overflow-hidden">
                  {% if post.featured_image %}
                  <img 
                    src="{{ post.featured_image.url }}" 
                    alt="{{ post.title }}" 
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                  {% else %}
                  <div class="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300"></div>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <h5 class="text-sm font-bold text-gray-900 line-clamp-2 mb-1">
                    <a 
                      href="{% url 'posts_by_category_page_or_post' slug=post.slug %}" 
                      class="hover:text-primary transition-colors"
                    >
                      {{ post.title }}
                    </a>
                  </h5>
                  <time class="text-xs text-gray-500">{{ post.published_date|date:"M j, Y" }}</time>
                </div>
              </article>
              {% endfor %}
            </div>
          </div>
          {% endif %}

        </div>
      </aside>
    </div>
  </div>
</div>
{% endblock %}